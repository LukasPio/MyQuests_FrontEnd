"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.handleInputOptionsAndValue=exports.getInputValue=void 0;var _showLoading=require("../../staticMethods/showLoading.js");var _classes=require("../classes.js");var _utils=require("../utils.js");var _domUtils=require("./domUtils.js");var dom=_interopRequireWildcard(require("./index.js"));function _getRequireWildcardCache(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap,t=new WeakMap;return(_getRequireWildcardCache=function _getRequireWildcardCache(e){return e?t:r})(e)}function _interopRequireWildcard(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return{"default":e};var t=_getRequireWildcardCache(r);if(t&&t.has(e))return t.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var i=a?Object.getOwnPropertyDescriptor(e,u):null;i&&(i.get||i.set)?Object.defineProperty(n,u,i):n[u]=e[u]}return n["default"]=e,t&&t.set(e,n),n}function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}/**
 * @param {SweetAlert} instance
 * @param {SweetAlertOptions} params
 */var handleInputOptionsAndValue=exports.handleInputOptionsAndValue=function handleInputOptionsAndValue(instance,params){if(params.input==="select"||params.input==="radio"){handleInputOptions(instance,params)}else if(["text","email","number","tel","textarea"].some(function(i){return i===params.input})&&((0,_utils.hasToPromiseFn)(params.inputValue)||(0,_utils.isPromise)(params.inputValue))){(0,_showLoading.showLoading)(dom.getConfirmButton());handleInputValue(instance,params)}};/**
 * @param {SweetAlert} instance
 * @param {SweetAlertOptions} innerParams
 * @returns {SweetAlertInputValue}
 */var getInputValue=exports.getInputValue=function getInputValue(instance,innerParams){var input=instance.getInput();if(!input){return null}switch(innerParams.input){case"checkbox":return getCheckboxValue(input);case"radio":return getRadioValue(input);case"file":return getFileValue(input);default:return innerParams.inputAutoTrim?input.value.trim():input.value}};/**
 * @param {HTMLInputElement} input
 * @returns {number}
 */var getCheckboxValue=function getCheckboxValue(input){return input.checked?1:0};/**
 * @param {HTMLInputElement} input
 * @returns {string | null}
 */var getRadioValue=function getRadioValue(input){return input.checked?input.value:null};/**
 * @param {HTMLInputElement} input
 * @returns {FileList | File | null}
 */var getFileValue=function getFileValue(input){return input.files&&input.files.length?input.getAttribute("multiple")!==null?input.files:input.files[0]:null};/**
 * @param {SweetAlert} instance
 * @param {SweetAlertOptions} params
 */var handleInputOptions=function handleInputOptions(instance,params){var popup=dom.getPopup();if(!popup){return}/**
   * @param {Record<string, any>} inputOptions
   */var processInputOptions=function processInputOptions(inputOptions){if(params.input==="select"){populateSelectOptions(popup,formatInputOptions(inputOptions),params)}else if(params.input==="radio"){populateRadioOptions(popup,formatInputOptions(inputOptions),params)}};if((0,_utils.hasToPromiseFn)(params.inputOptions)||(0,_utils.isPromise)(params.inputOptions)){(0,_showLoading.showLoading)(dom.getConfirmButton());(0,_utils.asPromise)(params.inputOptions).then(function(inputOptions){instance.hideLoading();processInputOptions(inputOptions)})}else if(_typeof(params.inputOptions)==="object"){processInputOptions(params.inputOptions)}else{(0,_utils.error)("Unexpected type of inputOptions! Expected object, Map or Promise, got ".concat(_typeof(params.inputOptions)))}};/**
 * @param {SweetAlert} instance
 * @param {SweetAlertOptions} params
 */var handleInputValue=function handleInputValue(instance,params){var input=instance.getInput();if(!input){return}dom.hide(input);(0,_utils.asPromise)(params.inputValue).then(function(inputValue){input.value=params.input==="number"?"".concat(parseFloat(inputValue)||0):"".concat(inputValue);dom.show(input);input.focus();instance.hideLoading()})["catch"](function(err){(0,_utils.error)("Error in inputValue promise: ".concat(err));input.value="";dom.show(input);input.focus();instance.hideLoading()})};/**
 * @param {HTMLElement} popup
 * @param {InputOptionFlattened[]} inputOptions
 * @param {SweetAlertOptions} params
 */function populateSelectOptions(popup,inputOptions,params){var select=(0,_domUtils.getDirectChildByClass)(popup,_classes.swalClasses.select);if(!select){return}/**
   * @param {HTMLElement} parent
   * @param {string} optionLabel
   * @param {string} optionValue
   */var renderOption=function renderOption(parent,optionLabel,optionValue){var option=document.createElement("option");option.value=optionValue;dom.setInnerHtml(option,optionLabel);option.selected=isSelected(optionValue,params.inputValue);parent.appendChild(option)};inputOptions.forEach(function(inputOption){var optionValue=inputOption[0];var optionLabel=inputOption[1];// <optgroup> spec:
// https://www.w3.org/TR/html401/interact/forms.html#h-17.6
// "...all OPTGROUP elements must be specified directly within a SELECT element (i.e., groups may not be nested)..."
// check whether this is a <optgroup>
if(Array.isArray(optionLabel)){// if it is an array, then it is an <optgroup>
var optgroup=document.createElement("optgroup");optgroup.label=optionValue;optgroup.disabled=false;// not configurable for now
select.appendChild(optgroup);optionLabel.forEach(function(o){return renderOption(optgroup,o[1],o[0])})}else{// case of <option>
renderOption(select,optionLabel,optionValue)}});select.focus()}/**
 * @param {HTMLElement} popup
 * @param {InputOptionFlattened[]} inputOptions
 * @param {SweetAlertOptions} params
 */function populateRadioOptions(popup,inputOptions,params){var radio=(0,_domUtils.getDirectChildByClass)(popup,_classes.swalClasses.radio);if(!radio){return}inputOptions.forEach(function(inputOption){var radioValue=inputOption[0];var radioLabel=inputOption[1];var radioInput=document.createElement("input");var radioLabelElement=document.createElement("label");radioInput.type="radio";radioInput.name=_classes.swalClasses.radio;radioInput.value=radioValue;if(isSelected(radioValue,params.inputValue)){radioInput.checked=true}var label=document.createElement("span");dom.setInnerHtml(label,radioLabel);label.className=_classes.swalClasses.label;radioLabelElement.appendChild(radioInput);radioLabelElement.appendChild(label);radio.appendChild(radioLabelElement)});var radios=radio.querySelectorAll("input");if(radios.length){radios[0].focus()}}/**
 * Converts `inputOptions` into an array of `[value, label]`s
 *
 * @param {Record<string, any>} inputOptions
 * @typedef {string[]} InputOptionFlattened
 * @returns {InputOptionFlattened[]}
 */var formatInputOptions=function formatInputOptions(inputOptions){/** @type {InputOptionFlattened[]} */var result=[];if(inputOptions instanceof Map){inputOptions.forEach(function(value,key){var valueFormatted=value;if(_typeof(valueFormatted)==="object"){// case of <optgroup>
valueFormatted=formatInputOptions(valueFormatted)}result.push([key,valueFormatted])})}else{Object.keys(inputOptions).forEach(function(key){var valueFormatted=inputOptions[key];if(_typeof(valueFormatted)==="object"){// case of <optgroup>
valueFormatted=formatInputOptions(valueFormatted)}result.push([key,valueFormatted])})}return result};/**
 * @param {string} optionValue
 * @param {SweetAlertInputValue} inputValue
 * @returns {boolean}
 */var isSelected=function isSelected(optionValue,inputValue){return!!inputValue&&inputValue.toString()===optionValue.toString()};