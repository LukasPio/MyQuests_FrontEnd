"use strict";function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}Object.defineProperty(exports,"__esModule",{value:true});exports.setFocus=exports.removeKeydownHandler=exports.addKeydownHandler=void 0;var _dom=require("./staticMethods/dom.js");var _DismissReason=require("./utils/DismissReason.js");var dom=_interopRequireWildcard(require("./utils/dom/index.js"));var _utils=require("./utils/utils.js");function _getRequireWildcardCache(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap,t=new WeakMap;return(_getRequireWildcardCache=function _getRequireWildcardCache(e){return e?t:r})(e)}function _interopRequireWildcard(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return{"default":e};var t=_getRequireWildcardCache(r);if(t&&t.has(e))return t.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var i=a?Object.getOwnPropertyDescriptor(e,u):null;i&&(i.get||i.set)?Object.defineProperty(n,u,i):n[u]=e[u]}return n["default"]=e,t&&t.set(e,n),n}/**
 * @param {GlobalState} globalState
 */var removeKeydownHandler=exports.removeKeydownHandler=function removeKeydownHandler(globalState){if(globalState.keydownTarget&&globalState.keydownHandlerAdded){globalState.keydownTarget.removeEventListener("keydown",globalState.keydownHandler,{capture:globalState.keydownListenerCapture});globalState.keydownHandlerAdded=false}};/**
 * @param {GlobalState} globalState
 * @param {SweetAlertOptions} innerParams
 * @param {*} dismissWith
 */var addKeydownHandler=exports.addKeydownHandler=function addKeydownHandler(globalState,innerParams,dismissWith){removeKeydownHandler(globalState);if(!innerParams.toast){globalState.keydownHandler=function(e){return keydownHandler(innerParams,e,dismissWith)};globalState.keydownTarget=innerParams.keydownListenerCapture?window:dom.getPopup();globalState.keydownListenerCapture=innerParams.keydownListenerCapture;globalState.keydownTarget.addEventListener("keydown",globalState.keydownHandler,{capture:globalState.keydownListenerCapture});globalState.keydownHandlerAdded=true}};/**
 * @param {number} index
 * @param {number} increment
 */var setFocus=exports.setFocus=function setFocus(index,increment){var _dom$getPopup;var focusableElements=dom.getFocusableElements();// search for visible elements and select the next possible match
if(focusableElements.length){index=index+increment;// rollover to first item
if(index===focusableElements.length){index=0;// go to last item
}else if(index===-1){index=focusableElements.length-1}focusableElements[index].focus();return}// no visible focusable elements, focus the popup
(_dom$getPopup=dom.getPopup())===null||_dom$getPopup===void 0||_dom$getPopup.focus()};var arrowKeysNextButton=["ArrowRight","ArrowDown"];var arrowKeysPreviousButton=["ArrowLeft","ArrowUp"];/**
 * @param {SweetAlertOptions} innerParams
 * @param {KeyboardEvent} event
 * @param {Function} dismissWith
 */var keydownHandler=function keydownHandler(innerParams,event,dismissWith){if(!innerParams){return;// This instance has already been destroyed
}// Ignore keydown during IME composition
// https://developer.mozilla.org/en-US/docs/Web/API/Document/keydown_event#ignoring_keydown_during_ime_composition
// https://github.com/sweetalert2/sweetalert2/issues/720
// https://github.com/sweetalert2/sweetalert2/issues/2406
if(event.isComposing||event.keyCode===229){return}if(innerParams.stopKeydownPropagation){event.stopPropagation()}// ENTER
if(event.key==="Enter"){handleEnter(event,innerParams)}// TAB
else if(event.key==="Tab"){handleTab(event)}// ARROWS - switch focus between buttons
else if([].concat(arrowKeysNextButton,arrowKeysPreviousButton).includes(event.key)){handleArrows(event.key)}// ESC
else if(event.key==="Escape"){handleEsc(event,innerParams,dismissWith)}};/**
 * @param {KeyboardEvent} event
 * @param {SweetAlertOptions} innerParams
 */var handleEnter=function handleEnter(event,innerParams){// https://github.com/sweetalert2/sweetalert2/issues/2386
if(!(0,_utils.callIfFunction)(innerParams.allowEnterKey)){return}var input=dom.getInput(dom.getPopup(),innerParams.input);if(event.target&&input&&event.target instanceof HTMLElement&&event.target.outerHTML===input.outerHTML){if(["textarea","file"].includes(innerParams.input)){return;// do not submit
}(0,_dom.clickConfirm)();event.preventDefault()}};/**
 * @param {KeyboardEvent} event
 */var handleTab=function handleTab(event){var targetElement=event.target;var focusableElements=dom.getFocusableElements();var btnIndex=-1;for(var i=0;i<focusableElements.length;i++){if(targetElement===focusableElements[i]){btnIndex=i;break}}// Cycle to the next button
if(!event.shiftKey){setFocus(btnIndex,1)}// Cycle to the prev button
else{setFocus(btnIndex,-1)}event.stopPropagation();event.preventDefault()};/**
 * @param {string} key
 */var handleArrows=function handleArrows(key){var actions=dom.getActions();var confirmButton=dom.getConfirmButton();var denyButton=dom.getDenyButton();var cancelButton=dom.getCancelButton();if(!actions||!confirmButton||!denyButton||!cancelButton){return}/** @type HTMLElement[] */var buttons=[confirmButton,denyButton,cancelButton];if(document.activeElement instanceof HTMLElement&&!buttons.includes(document.activeElement)){return}var sibling=arrowKeysNextButton.includes(key)?"nextElementSibling":"previousElementSibling";var buttonToFocus=document.activeElement;if(!buttonToFocus){return}for(var i=0;i<actions.children.length;i++){buttonToFocus=buttonToFocus[sibling];if(!buttonToFocus){return}if(buttonToFocus instanceof HTMLButtonElement&&dom.isVisible(buttonToFocus)){break}}if(buttonToFocus instanceof HTMLButtonElement){buttonToFocus.focus()}};/**
 * @param {KeyboardEvent} event
 * @param {SweetAlertOptions} innerParams
 * @param {Function} dismissWith
 */var handleEsc=function handleEsc(event,innerParams,dismissWith){if((0,_utils.callIfFunction)(innerParams.allowEscapeKey)){event.preventDefault();dismissWith(_DismissReason.DismissReason.esc)}};